<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal</title>
    <meta name="theme-color" content="#1c1c1c">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0c0c0c;
            --bg-secondary: #1c1c1c;
            --bg-tertiary: #2d2d2d;
            --text-primary: #e5e5e5;
            --text-secondary: #a0a0a0;
            --accent: #60cdff;
            --accent-hover: #4fb3e6;
            --border: rgba(255, 255, 255, 0.08);
            --overlay: rgba(28, 28, 28, 0.95);
            --close-hover: #c42b1c;
            --tab-hover: rgba(255, 255, 255, 0.06);
            --tab-active: rgba(255, 255, 255, 0.09);
        }

        body {
            font-family: 'Segoe UI Variable', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Title Bar - Windows 11 Style */
        .title-bar {
            height: 40px;
            min-height: env(titlebar-area-height, auto);
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            -webkit-app-region: drag;
            user-select: none;
            border-bottom: 1px solid var(--border);
        }

        .title-bar-drag-region {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 16px;
        }

        .title-bar-icon {
            width: 18px;
            height: 18px;
        }

        .title-bar-title {
            font-size: 12px;
            font-weight: 400;
            color: var(--text-primary);
        }

        .title-bar-controls {
            display: flex;
            height: 100%;
            -webkit-app-region: no-drag;
            padding-right: env(titlebar-area-width, calc(100% - env(titlebar-area-x, 100%)));
        }

        .title-bar-divider {
            width: 1px;
            height: 16px;
            background: var(--border);
            align-self: center;
            margin: 0 4px;
        }

        .title-bar-button {
            width: 46px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            transition: background-color 0.1s ease;
        }

        .title-bar-button:hover {
            background: var(--tab-hover);
        }

        .title-bar-button.close-btn:hover {
            background: var(--close-hover);
            color: white;
        }

        /* Tab Bar - Windows 11 Style */
        .tab-bar {
            height: 42px;
            background: var(--bg-secondary);
            display: flex;
            align-items: flex-end;
            border-bottom: 1px solid var(--border);
            padding: 0 8px;
            flex: 1;
        }

        .tab-list {
            display: flex;
            gap: 4px;
            flex: 1;
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;
        }

        .tab-list::-webkit-scrollbar {
            display: none;
        }

        .tab {
            height: 36px;
            min-width: 120px;
            max-width: 240px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 12px;
            background: transparent;
            border: none;
            border-radius: 6px 6px 0 0;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.1s ease;
            position: relative;
            user-select: none;
        }

        .tab:hover {
            background: var(--tab-hover);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 8px;
            right: 8px;
            height: 2px;
            background: var(--accent);
            border-radius: 2px 2px 0 0;
        }

        .tab-icon {
            font-size: 14px;
            flex-shrink: 0;
        }

        .tab-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tab-close {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            opacity: 0;
            transition: all 0.1s ease;
            flex-shrink: 0;
        }

        .tab:hover .tab-close {
            opacity: 1;
        }

        .tab-close:hover {
            background: var(--tab-hover);
        }

        .tab-actions {
            display: flex;
            align-items: center;
            padding: 0 4px;
        }

        .tab-action-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.1s ease;
        }

        .tab-action-btn:hover {
            background: var(--tab-hover);
            color: var(--text-primary);
        }

        /* Terminal Container */
        .terminal-container {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .terminal-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .terminal-wrapper {
            flex: 1;
            padding: 8px;
            overflow: hidden;
        }

        .pane-divider {
            width: 4px;
            background: var(--bg-secondary);
            cursor: col-resize;
            position: relative;
        }

        .pane-divider:hover {
            background: var(--accent);
        }

        .pane-divider.vertical {
            width: 100%;
            height: 4px;
            cursor: row-resize;
        }

        /* XTerm Styles */
        .xterm {
            height: 100%;
            padding: 0;
        }

        .xterm-viewport {
            background-color: transparent !important;
        }

        .xterm-screen {
            background-color: transparent !important;
        }

        /* Context Menu - Windows 11 Style */
        .context-menu {
            position: fixed;
            min-width: 240px;
            background: var(--overlay);
            backdrop-filter: blur(40px);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 4px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }

        .context-menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.1s ease;
        }

        .context-menu-item:hover {
            background: var(--tab-hover);
        }

        .context-menu-item .shortcut {
            font-size: 11px;
            color: var(--text-secondary);
            margin-left: 24px;
        }

        .context-menu-divider {
            height: 1px;
            background: var(--border);
            margin: 4px 0;
        }

        /* Command Palette - Windows 11 Style */
        .command-palette {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            max-width: 90vw;
            background: var(--overlay);
            backdrop-filter: blur(40px);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.6);
            z-index: 2000;
            display: none;
            overflow: hidden;
        }

        .command-palette-input-wrapper {
            display: flex;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        .command-palette-icon {
            color: var(--text-secondary);
            margin-right: 12px;
        }

        .command-palette-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            font-size: 15px;
            color: var(--text-primary);
            font-family: inherit;
        }

        .command-palette-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .command-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.1s ease;
        }

        .command-item:hover,
        .command-item.selected {
            background: var(--tab-active);
        }

        .command-item-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            border-radius: 6px;
            background: var(--bg-tertiary);
            font-size: 16px;
        }

        .command-item-text {
            flex: 1;
        }

        .command-item-title {
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .command-item-description {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .command-item-shortcut {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 6px;
            border: 3px solid var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3d3d3d;
        }

        /* Focus Styles */
        /* .terminal-pane.focused {
            outline: 2px solid var(--accent);
            outline-offset: -2px;
        } */
    </style>
</head>

<body>
    <!-- Title Bar -->
    <div class="title-bar" id="title-bar">
        <div class="title-bar-drag-region">
            <img class="title-bar-icon" src="favicon.ico">
        </div>

        <div class="tab-bar" id="tab-bar">
            <div class="tab-list" id="tab-list"></div>
            <div class="tab-actions">
                <button class="tab-action-btn" id="dropdown-btn" title="Êõ¥Â§öÈÄâÈ°π">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 10.5l-4-4h8l-4 4z" />
                    </svg>
                </button>
            </div>
        </div>

        <div class="title-bar-controls">
            <button class="title-bar-button" id="new-tab-btn" title="Êñ∞Âª∫Ê†áÁ≠æÈ°µ">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                    <path d="M6.5 1.5v4h4v1h-4v4h-1v-4h-4v-1h4v-4h1z" />
                </svg>
            </button>
            <div class="title-bar-divider"></div>
        </div>
    </div>

    <!-- Terminal Container -->
    <div class="terminal-container" id="terminal-container"></div>

    <!-- Command Palette -->
    <div class="command-palette" id="command-palette">
        <div class="command-palette-input-wrapper">
            <svg class="command-palette-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path
                    d="M11.5 2a4.5 4.5 0 11-3.163 7.663L3.5 14.5l-.707-.707 4.837-4.837A4.5 4.5 0 0111.5 2zm0 1a3.5 3.5 0 100 7 3.5 3.5 0 000-7z" />
            </svg>
            <input type="text" class="command-palette-input" id="command-palette-input" placeholder="ËæìÂÖ•ÂëΩ‰ª§...">
        </div>
        <div class="command-palette-list" id="command-palette-list"></div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <div class="context-menu-item" data-action="copy">
            <span>Â§çÂà∂</span>
            <span class="shortcut">Ctrl+Shift+C</span>
        </div>
        <div class="context-menu-item" data-action="paste">
            <span>Á≤òË¥¥</span>
            <span class="shortcut">Ctrl+Shift+V</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" data-action="split-horizontal">
            <span>Ê∞¥Âπ≥ÊãÜÂàÜÁ™óÊ†º</span>
            <span class="shortcut">Alt+Shift+-</span>
        </div>
        <div class="context-menu-item" data-action="split-vertical">
            <span>ÂûÇÁõ¥ÊãÜÂàÜÁ™óÊ†º</span>
            <span class="shortcut">Alt+Shift++</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" data-action="clear">
            <span>Ê∏ÖÁ©∫ÁªàÁ´Ø</span>
            <span class="shortcut">Ctrl+L</span>
        </div>
        <div class="context-menu-item" data-action="settings">
            <span>ËÆæÁΩÆ</span>
            <span class="shortcut">Ctrl+,</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.min.js"></script>
    <script>
        // Terminal Manager - ÊîØÊåÅÂ§öÂÆû‰æã
        class TerminalManager {
            constructor() {
                this.tabs = [];
                this.activeTabId = null;
                this.tabCounter = 0;
                this.init();
            }

            init() {
                this.registerServiceWorker();
                this.setupEventListeners();
                this.createTab(); // ÂàõÂª∫ÂàùÂßãÊ†áÁ≠æÈ°µ
                this.loadCommandPalette();
            }

            // Ê≥®ÂÜå Service Worker
            async registerServiceWorker() {
                // if ('serviceWorker' in navigator) {
                //     try {
                //         await navigator.serviceWorker.register('/sw.js');
                //         console.log('Service Worker registered');
                //     } catch (error) {
                //         console.error('Service Worker registration failed:', error);
                //     }
                // }
            }

            // ÂàõÂª∫Êñ∞Ê†áÁ≠æÈ°µ
            createTab(profile = 'bash') {
                const tabId = `tab-${++this.tabCounter}`;

                const tab = {
                    id: tabId,
                    title: profile,
                    profile: profile,
                    term: null,
                    fitAddon: null,
                    socket: null,
                    element: null,
                    paneElement: null
                };

                // ÂàõÂª∫Ê†áÁ≠æÂÖÉÁ¥†
                const tabElement = document.createElement('div');
                tabElement.className = 'tab';
                tabElement.dataset.tabId = tabId;
                tabElement.innerHTML = `
            <span class="tab-icon">‚ùØ</span>
            <span class="tab-title">${profile}</span>
            <button class="tab-close">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                    <path d="M2.22 2.22l7.56 7.56m0-7.56l-7.56 7.56" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
            </button>
        `;

                // ÂàõÂª∫ÁªàÁ´ØÁ™óÊ†º
                const paneElement = document.createElement('div');
                paneElement.className = 'terminal-pane';
                paneElement.dataset.tabId = tabId;
                paneElement.style.display = 'none';

                const wrapperElement = document.createElement('div');
                wrapperElement.className = 'terminal-wrapper';
                paneElement.appendChild(wrapperElement);

                // ÂàùÂßãÂåñ XTerm
                const term = new Terminal({
                    fontSize: 16,
                    fontFamily: '"Cascadia Code", "Cascadia Mono", Consolas, "Courier New", monospace',
                    cursorBlink: true,
                    cursorStyle: 'bar',
                    theme: {
                        background: '#0c0c0c',
                        foreground: '#e5e5e5',
                        cursor: '#ffffff',
                        cursorAccent: '#0c0c0c',
                        selection: 'rgba(96, 205, 255, 0.3)',
                        black: '#0c0c0c',
                        red: '#c50f1f',
                        green: '#13a10e',
                        yellow: '#c19c00',
                        blue: '#0037da',
                        magenta: '#881798',
                        cyan: '#3a96dd',
                        white: '#cccccc',
                        brightBlack: '#767676',
                        brightRed: '#e74856',
                        brightGreen: '#16c60c',
                        brightYellow: '#f9f1a5',
                        brightBlue: '#3b78ff',
                        brightMagenta: '#b4009e',
                        brightCyan: '#61d6d6',
                        brightWhite: '#f2f2f2'
                    },
                    allowTransparency: false,
                    scrollback: 10000,
                    tabStopWidth: 4
                });

                const fitAddon = new FitAddon.FitAddon();
                const webLinksAddon = new WebLinksAddon.WebLinksAddon();

                term.loadAddon(fitAddon);
                term.loadAddon(webLinksAddon);
                term.open(wrapperElement);

                tab.term = term;
                tab.fitAddon = fitAddon;
                tab.element = tabElement;
                tab.paneElement = paneElement;

                // Ê∑ªÂä†Âà∞ DOM
                document.getElementById('tab-list').appendChild(tabElement);
                document.getElementById('terminal-container').appendChild(paneElement);

                // ‰∫ã‰ª∂ÁõëÂê¨
                tabElement.addEventListener('click', (e) => {
                    if (!e.target.closest('.tab-close')) {
                        this.switchTab(tabId);
                    }
                });

                tabElement.querySelector('.tab-close').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.closeTab(tabId);
                });

                paneElement.addEventListener('click', () => {
                    this.switchTab(tabId);
                });

                this.tabs.push(tab);
                this.switchTab(tabId);
                this.connectWebSocket(tab);

                return tab;
            }

            // ÂàáÊç¢Ê†áÁ≠æÈ°µ
            switchTab(tabId) {
                this.tabs.forEach(tab => {
                    const isActive = tab.id === tabId;
                    tab.element.classList.toggle('active', isActive);
                    tab.paneElement.style.display = isActive ? 'flex' : 'none';
                    tab.paneElement.classList.toggle('focused', isActive);
                });

                this.activeTabId = tabId;
                const activeTab = this.getTab(tabId);

                if (activeTab) {
                    setTimeout(() => {
                        activeTab.fitAddon.fit();
                        this.updateTerminalSize(activeTab);
                        activeTab.term.focus();
                    }, 50);
                }
            }

            // ÂÖ≥Èó≠Ê†áÁ≠æÈ°µ
            closeTab(tabId) {
                const index = this.tabs.findIndex(t => t.id === tabId);
                if (index === -1) return;

                const tab = this.tabs[index];

                // ÂÖ≥Èó≠ WebSocket
                if (tab.socket) {
                    tab.socket.close();
                }

                // Ê∏ÖÁêÜ DOM
                tab.element.remove();
                tab.paneElement.remove();

                // ‰ªéÊï∞ÁªÑ‰∏≠ÁßªÈô§
                this.tabs.splice(index, 1);

                // Â¶ÇÊûúÂÖ≥Èó≠ÁöÑÊòØÂΩìÂâçÊ†áÁ≠æÔºåÂàáÊç¢Âà∞ÂÖ∂‰ªñÊ†áÁ≠æ
                if (tab.id === this.activeTabId) {
                    if (this.tabs.length > 0) {
                        const newActiveTab = this.tabs[Math.max(0, index - 1)];
                        this.switchTab(newActiveTab.id);
                    } else {
                        // Â¶ÇÊûúÊ≤°ÊúâÊ†áÁ≠æ‰∫ÜÔºåÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ
                        this.createTab();
                    }
                }
            }

            // Ëé∑ÂèñÊ†áÁ≠æ
            getTab(tabId) {
                return this.tabs.find(t => t.id === tabId);
            }

            // Ëé∑ÂèñÊ¥ªÂä®Ê†áÁ≠æ
            getActiveTab() {
                return this.getTab(this.activeTabId);
            }

            // ËøûÊé• WebSocket
            connectWebSocket(tab) {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const host = window.location.host;
                const socketUrl = `${protocol}//${host}/ws`;

                tab.socket = new WebSocket(socketUrl);
                tab.socket.binaryType = 'arraybuffer';

                tab.socket.onopen = () => {
                    this.updateTerminalSize(tab);

                    const toU8 = any => new Uint8Array(
                        typeof any === 'string' ? new TextEncoder().encode(any) : any
                    );

                    tab.term.onData(data => {
                        if (tab.socket && tab.socket.readyState === WebSocket.OPEN) {
                            tab.socket.send(toU8(data));
                        }
                    });

                    tab.socket.onmessage = (event) => {
                        tab.term.write(toU8(event.data));
                    };
                };

                tab.socket.onclose = () => {
                    console.log(`Tab ${tab.id} disconnected`);
                };

                tab.socket.onerror = (error) => {
                    console.error(`Tab ${tab.id} error:`, error);
                };
            }

            // Êõ¥Êñ∞ÁªàÁ´ØÂ∞∫ÂØ∏
            updateTerminalSize(tab) {
                if (tab.socket && tab.socket.readyState === WebSocket.OPEN) {
                    const cols = tab.term.cols;
                    const rows = tab.term.rows;
                    tab.socket.send(JSON.stringify({ col: cols, row: rows }));
                }
            }

            // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨
            setupEventListeners() {
                // Êñ∞Âª∫Ê†áÁ≠æ
                document.getElementById('new-tab-btn').addEventListener('click', () => {
                    this.createTab();
                });

                // Á™óÂè£Â§ßÂ∞èË∞ÉÊï¥
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        const activeTab = this.getActiveTab();
                        if (activeTab) {
                            activeTab.fitAddon.fit();
                            this.updateTerminalSize(activeTab);
                        }
                    }, 100);
                });

                // Âè≥ÈîÆËèúÂçï
                const contextMenu = document.getElementById('context-menu');

                document.getElementById('terminal-container').addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    contextMenu.style.display = 'block';
                    contextMenu.style.left = e.pageX + 'px';
                    contextMenu.style.top = e.pageY + 'px';
                });

                document.addEventListener('click', () => {
                    contextMenu.style.display = 'none';
                });

                // ‰∏ä‰∏ãÊñáËèúÂçïÊìç‰Ωú
                contextMenu.addEventListener('click', async (e) => {
                    const item = e.target.closest('.context-menu-item');
                    if (!item) return;

                    const action = item.dataset.action;
                    const activeTab = this.getActiveTab();
                    if (!activeTab) return;

                    switch (action) {
                        case 'copy':
                            const selection = activeTab.term.getSelection();
                            if (selection) {
                                await navigator.clipboard.writeText(selection);
                            }
                            break;
                        case 'paste':
                            try {
                                const text = await navigator.clipboard.readText();
                                activeTab.term.paste(text);
                            } catch (err) {
                                console.error('Paste error:', err);
                            }
                            break;
                        case 'clear':
                            activeTab.term.clear();
                            break;
                        case 'split-horizontal':
                            console.log('Split horizontal - ÂäüËÉΩÂæÖÂÆûÁé∞');
                            break;
                        case 'split-vertical':
                            console.log('Split vertical - ÂäüËÉΩÂæÖÂÆûÁé∞');
                            break;
                    }
                });

                // Âø´Êç∑ÈîÆ
                document.addEventListener('keydown', async (e) => {
                    // Ctrl+Shift+C - Â§çÂà∂
                    if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                        e.preventDefault();
                        const activeTab = this.getActiveTab();
                        if (activeTab) {
                            const selection = activeTab.term.getSelection();
                            if (selection) {
                                await navigator.clipboard.writeText(selection);
                            }
                        }
                    }

                    // Ctrl+Shift+V - Á≤òË¥¥
                    if (e.ctrlKey && e.shiftKey && e.key === 'V') {
                        e.preventDefault();
                        const activeTab = this.getActiveTab();
                        if (activeTab) {
                            try {
                                const text = await navigator.clipboard.readText();
                                activeTab.term.paste(text);
                            } catch (err) {
                                console.error('Paste error:', err);
                            }
                        }
                    }

                    // Ctrl+Shift+T - Êñ∞Âª∫Ê†áÁ≠æ
                    if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                        e.preventDefault();
                        this.createTab();
                    }

                    // Ctrl+Shift+W - ÂÖ≥Èó≠Ê†áÁ≠æ
                    if (e.ctrlKey && e.shiftKey && e.key === 'W') {
                        e.preventDefault();
                        if (this.activeTabId) {
                            this.closeTab(this.activeTabId);
                        }
                    }

                    // Ctrl+Shift+P - ÂëΩ‰ª§Èù¢Êùø
                    if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                        e.preventDefault();
                        this.toggleCommandPalette();
                    }

                    // Ctrl+Tab - ‰∏ã‰∏Ä‰∏™Ê†áÁ≠æ
                    if (e.ctrlKey && e.key === 'Tab') {
                        e.preventDefault();
                        const currentIndex = this.tabs.findIndex(t => t.id === this.activeTabId);
                        const nextIndex = (currentIndex + 1) % this.tabs.length;
                        this.switchTab(this.tabs[nextIndex].id);
                    }

                    // Ctrl+L - Ê∏ÖÂ±è
                    if (e.ctrlKey && e.key === 'l') {
                        e.preventDefault();
                        const activeTab = this.getActiveTab();
                        if (activeTab) {
                            activeTab.term.clear();
                        }
                    }
                });

                // ‰∏ãÊãâËèúÂçï
                document.getElementById('dropdown-btn').addEventListener('click', () => {
                    this.toggleCommandPalette();
                });
            }

            // Âä†ËΩΩÂëΩ‰ª§Èù¢Êùø
            loadCommandPalette() {
                const commands = [
                    { icon: '‚ùØ', title: 'Êñ∞Âª∫Ê†áÁ≠æÈ°µ', description: 'bash', action: () => this.createTab('bash') },
                    { icon: '‚öôÔ∏è', title: 'ËÆæÁΩÆ', description: 'ÊâìÂºÄËÆæÁΩÆ', action: () => console.log('Settings') },
                    { icon: 'üé®', title: '‰∏ªÈ¢ò', description: 'Êõ¥ÊîπÈÖçËâ≤ÊñπÊ°à', action: () => console.log('Theme') },
                    { icon: 'üìã', title: 'Â§çÂà∂', description: 'Â§çÂà∂ÈÄâÂÆöÊñáÊú¨', action: () => this.copySelection() },
                    { icon: 'üìÑ', title: 'Á≤òË¥¥', description: 'Á≤òË¥¥Ââ™Ë¥¥ÊùøÂÜÖÂÆπ', action: () => this.pasteClipboard() }
                ];

                const paletteList = document.getElementById('command-palette-list');
                commands.forEach((cmd, index) => {
                    const item = document.createElement('div');
                    item.className = 'command-item';
                    if (index === 0) item.classList.add('selected');
                    item.innerHTML = `
                <div class="command-item-icon">${cmd.icon}</div>
                <div class="command-item-text">
                    <div class="command-item-title">${cmd.title}</div>
                    <div class="command-item-description">${cmd.description}</div>
                </div>
            `;
                    item.addEventListener('click', () => {
                        cmd.action();
                        this.toggleCommandPalette();
                    });
                    paletteList.appendChild(item);
                });

                // ÂëΩ‰ª§Èù¢ÊùøÊêúÁ¥¢
                const input = document.getElementById('command-palette-input');
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.toggleCommandPalette();
                    }
                });
            }

            // ÂàáÊç¢ÂëΩ‰ª§Èù¢Êùø
            toggleCommandPalette() {
                const palette = document.getElementById('command-palette');
                const isVisible = palette.style.display === 'block';
                palette.style.display = isVisible ? 'none' : 'block';

                if (!isVisible) {
                    document.getElementById('command-palette-input').focus();
                }
            }

            // Â§çÂà∂ÈÄâÊã©
            async copySelection() {
                const activeTab = this.getActiveTab();
                if (activeTab) {
                    const selection = activeTab.term.getSelection();
                    if (selection) {
                        await navigator.clipboard.writeText(selection);
                    }
                }
            }

            // Á≤òË¥¥Ââ™Ë¥¥Êùø
            async pasteClipboard() {
                const activeTab = this.getActiveTab();
                if (activeTab) {
                    try {
                        const text = await navigator.clipboard.readText();
                        activeTab.term.paste(text);
                    } catch (err) {
                        console.error('Paste error:', err);
                    }
                }
            }
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        const terminalManager = new TerminalManager();
    </script>
</body>

</html>